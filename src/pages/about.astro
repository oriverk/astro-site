---
import matter from 'gray-matter'
import { format } from 'date-fns'
import ja from 'date-fns/locale/ja/index.js'

import { getAge } from '../utils/getAge'
import { getRepoRawContent } from '../utils/github/getRepoRawContent'
import { parseMarkdown } from '../utils/markdown/'
import Layout from '../layouts/Layout.astro'
import ContentWrapper from '../components/ui/ContentWrapper.svelte'
import Markdown from '../components/ui/Markdown.svelte'

const token = import.meta.env.GITHUB_TOKEN
const raw = await getRepoRawContent(
  token,
  'oriverk',
  'oriverk-docs',
  'cv/index.md'
)
const { content, data } = matter(raw)
const today = format(new Date(), 'yyyy年MM月dd日', { locale: ja });
const markdown = content
  .replace("{{ age }}", getAge('1993-09-11').toString())
  .replace("{{ date }}", today);
const html = parseMarkdown(markdown);
---

<Layout title="About" noindex>
  <article>
    <ContentWrapper>
      <div class="about">
        <h1>About</h1>
        <table>
          <caption>Frontmatter</caption>
          <tbody>
            {Object.entries(data).map(([key, value]) => (
              <tr>
                <th>{key.toUpperCase()}</th>
                <td>{value}</td>
              </tr>
            ))}
          </tbody>
        </table>
        <Markdown set:html={html} />
      </div>
    </ContentWrapper>
  </article>
</Layout>

<style lang="scss">
  h1 {
    font-size: 2.5rem;
    font-weight: 700;
  }

  table {
    margin: 0;
    border-collapse: collapse;

    caption {
      color: rgb(var(--color-lightgray));
      font-size: 1rem;
      padding: 0.5rem 0;
    }

    th {
      padding: 0.25rem 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }

    td {
      padding: 0.25rem 0.5rem;
      border: 1px solid #ccc;
    }
  }
</style>
